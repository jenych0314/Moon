---
layout: post
title: "PHP와 DB"
date: 2024-10-23
last_modified_at: 2024-11-01
excerpt: "모의해킹 취업반 스터디 7기 2주차"
tags: [WEB]
comments: true
---


# HTTP란?
HTTP(Hyper Text Transfer Protocol)<sup>1, 2</sup>:  인터넷 상에서 정보를 주고받을 수 있도록 하는 약속/규칙이다.
Hyper Text<sup>3</sup>를 전송하는 Protocol이다.
www 상에서 정보를 주고받을 수 있는 프로토콜
클라이언트와 서버 사이에 이루어지는 요청/응답(request/response) 프로토콜

# HTTP/1.X와 HTTP/2<sup>4, 5, 6</sup>
HTTP/1.X: 199X년 개발
HTTP/2: 2015년 개발
latency 감소 -> 멀티플렉싱(Multiplexing)
서버에서 클라이언트로 먼저 데이터를 보낼 수 있는 방법 -> 서버 푸시(Server Push)
네트워크 통신에 필요한 데이터량 감소 -> 헤더 압축(Header Compression)

## 멀티플렉싱(Multiplexing)
멀티플렉싱이란 여러 개의 입력을 하나의 출력으로 만들어주는 기능<sup>7</sup>이다.
http/1.1은 한 개의 연결 당 한 개의 응답만 보낼 수 있었다.
http/2에서는  한 개의 연결에서 N 개의 응답을 보낼 수 있다.
~~1차선에서 8차선 고속 도로된 느낌~~
 
## 서버 푸시(Server Push)
일반적으로 서버는 클라이언트가 요청하는 경우에만 클라이언트 장치에 콘텐츠를 제공합니다.
그러나 이 접근 방식은 클라이언트가 요청해야 하는 수십 개의 개별 리소스를 포함하는 최신 웹 페이지에서는 항상 실용적인 것은 아닙니다.
HTTP/2는 클라이언트가 요청하기 전에 서버가 클라이언트에 콘텐츠를 "푸시"할 수 있도록 하여 이 문제를 해결합니다.
서버는 또한 Bob이 모든 것을 보내기 전에 Alice에게 소설의 목차를 보낸 경우와 같이, 예상되는 콘텐츠를 푸시한 내용을 클라이언트에게 알려주는 메시지를 보냅니다.

## 헤더 압축(Header Compression)
작은 파일은 큰 파일보다 더 빨리 로드됩니다.
웹 성능 속도를 높이기 위해 HTTP/1.1 및 HTTP/2는 모두 HTTP 메시지를 압축하여 더 작게 만듭니다.
그러나 HTTP/2는 HTTP 헤더 패킷에서 중복 정보를 제거하는 **HPACK**이라는 고급 압축 방법을 사용합니다.
이렇게 하면 모든 HTTP 패킷에서 몇 바이트가 제거됩니다.
단일 웹 페이지를 로드하는 데 관련되는 HTTP 패킷의 양을 고려할 때, 이러한 바이트는 빠르게 합산되어 로드 속도가 빨라집니다.

# Q1. http/1.1이랑 http/2랑 호환 X?<sup>8, 9</sup>
아주 친절하게 설명해주시는 데
ALPN protocol (Application Layer Protocol Negotiation)
HTTP2를 사용하는 쪽에서 TLS connection을 통해 상대측에게 '야, 너 HTTP2 가능하냐?'라고 물어봐서 무슨 말을 할 수 있는 지 확인하기 때문에 상관이 없다고 한다. 


# 참고

 1. https://www.cloudflare.com/ko-kr/learning/ddos/glossary/hypertext-transfer-protocol-http/
 2. https://ko.wikipedia.org/wiki/HTTP
 3. https://ko.wikipedia.org/wiki/%ED%95%98%EC%9D%B4%ED%8D%BC%ED%85%8D%EC%8A%A4%ED%8A%B8
 4. https://www.cloudflare.com/ko-kr/learning/performance/http2-vs-http1.1/
 5. https://blog.bespinglobal.com/post/http1-1-http2/
 6. https://seo-tory.tistory.com/82
 7. https://12bme.tistory.com/741
 8. https://stackoverflow.com/questions/36500050/what-if-an-http-1-1-client-talk-to-an-http-2-only-server-and-what-if-an-http-2-c
 9. https://stackoverflow.com/questions/63856886/if-a-browser-is-http1-x-compatible-is-it-also-http2-compatable

css를 이용해서 하는 공격이 있다고?
내부 ip / 외부 ip
bootstrap이란?
우선순위: html > php
<?php
    if($_GET['login_id'] == "") {
        header("location: login.php");
        exit;
    }
?>
php header 코드 확인하기
응답헤더 login.php로 리다이렉트
3XX 코드
exit를 해야 코드가 노출 되지 않는다

302found
redirect는 되지만 html 코드가 다 보임
노출되면?
burp suite란?

action="" -> 자기 자신에게 데이터 보냄
if(isset($_POST['Submit'])) {
    $login_res = login1($_POST['UserId'], $_POST['Password']);
    echo "this > " . $login_res;
}

submit 말고 뭐가 더 있는 지
무슨 역할인지

외부 php import 하기
<?php
require_once('login_func.php');
?>

require_twice도 있나? ㅋㅋ
function login1($userid, $userpass) {
    $crew_id = "admin";
    $crew_ps = "admin1234";

    if ($userid == $crew_id and $userpass == $crew_ps) {
        return $userid;
    }
    else return 0;
}

nbsp?

에러 발견했을 때?
php code가 죽었을 때 그냥 죽어버리던데
1. 에러 출력: php error 출력
2. echo로 확인하기

NAT 네트워크는 호스트와 VM이 같은 IP대역대를 갖게 되면 NAT 네트워크가 충돌하거나, 호스트 시스템이 네트워크 트래픽을 제대로 라우팅하지 못할 가능성이 큽니다. 네트워크 장치가 동일한 IP 대역에서 어떤 장치로 데이터를 보내야할지 명확히 구분하기 힘들기 때문입니다.

테스트 하신 것과 같이 IP 대역대가 동일하다면 사실상 그건 브릿지와 개념상 다를 바가 없습니다. 대역대를 같이 쓰려면 브릿지를 써야합니다. NAT을 쓰려면 대역대를 다르게 써야합니다.

NAT 설정의 예를 들어 호스트 IP가 192.168.0.10이라면 subnet ip를 192.168.10.0으로 바꾸시면 원하시는 NAT에서의 외부 접속이 가능합니다.
포트포워딩

database: 데이터를 저장한다
was <-> db

db ≓ 엑셀
database -> excel file
table -> excel sheet
column: 열, 데이터 종류, 카테고리, 세로
row: 행, 가로 데이터

http://192.168.219.197:1018/phpmyadmin/
admin
student1234
utf8_generalci
variable character =/=? text
auto increament
primary

query

SQL
was가 db한테 명령을 알아서 하도록
sql말고도 없을까?
select: 데이터를 가져온다
select [col] from [table]
e.g. select id from test
select [col1, col2] from [table]
select [*] from [table]

insert: 데이터를 넣는다
insert into [table] (col) value (value)
e.g. insert into test (id) ('hong')
insert into [table] (col) value (value)
e.g. insert into test (id, int) ('hong', 7)
e.g. insert into test value (NULL, '')

where: 조건에 맞는 데이터를 가져온다
select [col] from [table] where [조건]
e.g. select name from test where name='hong'
e.g. select name,pass from test where name='hong' and pass='1234'
e.g. select name,pass from test where name='hong' or pass='1234'

php에서 sql 문구를 어떻게 작성하느냐?
was-db 연결 = php와 mysql 연동시키기
<?php
    define('DB_SERVER', 'localhost(ip)');
    define('DB_USERNAME', 'admin');
    define('DB_PASSWORD', 'student1234');
    define('DB_NAME', 'test');

    $db_conn = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);

    if ($db_conn) {
        echo "DB Connect OK";
    } else {
        echo "DB Connect Fail";
    }

    $sql = "select * from test";
    $result = mysqli_query($db_conn, $sql);
    
    echo $result;
    var_dump($result);

    $row1 = mysqli_fetch_array($result); // 무조건 순서대로 한 줄씩 가져온다 readline 같은 느낌으로
    $row2 = mysqli_fetch_array($result);
    $row3 = mysqli_fetch_array($result);

    echo "Name: " . $row1['name']; // string1 . string2 => string1string2
    // 약간 python dictionary 같은 느낌

    if($_POST['userpass'] == $db_pass) {
        login OK
    }
?>

was에 db의 id와 pw가 무조건 들어있다
web shell을 까면 db 추측을 먼저 해야 한다
hash로 못 숨기나?
php 함수일 때는 $ 안 붙이고 모든 변수 앞에서는 $ 붙이는 듯
선언을 했든 안 했든
디스크립토
descrypto
echo는 함수가 아닌가? 함수에는 ()로 둘러싸여 있는거 같은데??
너무 자주 쓰여서 예외 처리 해놓은 걸수도

과제
1. 복습
2. get 방식으로 학생의 이름을 넣으면 그 학생의 점수가 출력되는 페이지 만들기
doldol 학생의 점수는 80입니다
3. 회원가입 페이지 만들기 (기능 구현)
4. 로그인 페이지 (db 연동)
5. 가입한 나의 정보를 보는 "마이페이지" 개발