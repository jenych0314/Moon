# File Upload

## 정의
공격자가 원하는 임의의 파일을 업로드

## 발생 원인
* 파일을 업로드 받을 때
* 검증, 검사를 안 한다

## 발생 위치
파일을 업로드할 수 있는 곳

## 공격 시나리오
* 서버 측 실행 파일 업로드
    -> 서버에서 우리가 원하는 코드를 실행할 수 있다
    -> 우리가 서버에게 원하는 명령을 내릴 수 있다
    -> 서버를 장악할 수 이싿
* HTML 파일 업로드 -> Phising
* Deface 공격
    -> index 파일 (덮어쓰기)
* XSS
    -> Stored XSS
* DoS

### 서버 측 실행 파일 -> Web Shell
```php
<?php
    echo system($_GET['cmd']);
?>
```
-> 'cmd' 파라미터를 넣어줘야 함
ex) example.com?cmd=''

reverse shell

### 웹쉘 공격의 핵심
1. 웹 서버 측 실행 코드를 업로드
2. 업로드 된 파일의 경로
    -> 업로드 한 파일이 출력되는 곳을 확인한다다
    -> 업로드 한 파일의 경로를 알아야 요청을 하고 실행할 수 있다

파일 업로드 공격 =- 웹쉘 공격

astx -> e2e
리버싱 기본은 해야 한다

## 대응
* 업로드 되는 파일을 검사하자, 제한하기
MIME
Content-Type: text/php
content type 변조

* 실행X
/files/avatars/~~~
특정 폴더 파일들의 실행 권한 제거
-> 파일 이름의 '../' 붙이기

* php 확장자 금지
-> PhP, pHp, pHP 등으로 파일명 변경
-> .phtml, .php3, .php5
-> .jsp, .jpsx, .jsw

-> hex editor
<? php system($_ㅎㄸㅆ['cmd']); ?>

파일 시그니처: jpeg, png, pdf ...

* 서버 측 실행 코드 업로드
-> 서버에서 실행하기 위해서
-> 서버에서 실행할 수 있도록 업로드
webshell.php

파일 업로드 취약점을 찾을 때 주의할 점
모의해킹을 할 때 주의할 점
웹쉘 올리면 안 됨
테스트할 때, 웹쉘을 올리는 이유
-> 업로드한 파일을 실행할 수 있는 지 체크
-> 협의
-> 웹쉘 테스트 후, 바로 삭제
-> 삭제 요청 -> 체크
